- hosts: all
  become: true
  vars:
  ipadrhost: 10.0.0.101
  
  tasks:
    - name: Install aptitude
      apt:
        name: aptitude
        state: latest
        update_cache: true

    - name: update
      apt:
      upgrade=dist
      force_apt_get=yes

    - name: Install Rsyslog
      apt:
        pkg:
           - rsyslog
        state: latest
        update_cache: true

    - name: Add rsyslog conf
      lineinfile:
        dest: /etc/rsyslog.conf
        regexp: '\Z'
        line: '{{ item }}
      with_items:       
        - "*.* @{{ ipadrhost }}:514"
        - "*.* @{{ ipadrhost }}:50514"
        - "$ActionQueueFileName queue"
        - "$ActionQueueSaveOnShutdown on"
        - "$ActionQueueType LinkedList"
        - "$ActionQueueMaxDiskSpace 1g"
        - "$ActionResumeRetryCount -1"

    - name: Restart rsyslog
      ansible.builtin.service:
       name: rsyslog
       state: restarted
       enabled: true
